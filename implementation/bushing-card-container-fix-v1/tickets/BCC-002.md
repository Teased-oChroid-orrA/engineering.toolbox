# BCC-002: Implement Single Main Container for Free Positioning

## Priority
**MEDIUM** - Enhancement after fixing critical bug

## Description
Create a single main container that allows all bushing toolbox cards to be repositioned anywhere on the screen, not just within their lanes. This enables better customization and flexibility.

## Requirements
1. Cards should be draggable to any position on screen
2. Positions should persist across page reloads
3. Maintain backward compatibility with lane-based layout
4. Support both lane mode and free positioning mode

## Solution Architecture
Create a new `BushingCardContainer.svelte` component that:
- Provides a full-screen canvas for card positioning
- Uses absolute positioning for cards
- Stores x,y coordinates for each card
- Handles drag-and-drop with position tracking
- Provides optional grid snapping

## Implementation Steps

### 1. Create BushingCardContainer Component
```typescript
// src/lib/components/bushing/BushingCardContainer.svelte
<script lang="ts">
  export let cards: Array<{id: string, x: number, y: number}>;
  export let mode: 'lanes' | 'free' = 'lanes';
  
  function handleCardMove(cardId: string, x: number, y: number) {
    // Update position
  }
</script>

<div class="relative w-full h-screen overflow-auto">
  {#each cards as card}
    <div 
      class="absolute" 
      style="left: {card.x}px; top: {card.y}px;"
      draggable="true"
      on:dragend={(e) => handleCardMove(card.id, e.clientX, e.clientY)}>
      <slot name={card.id} />
    </div>
  {/each}
</div>
```

### 2. Update Persistence Layer
Migrate from `scd.bushing.layout.v3` to `scd.bushing.layout.v4`:
```json
{
  "version": 4,
  "mode": "lanes",
  "leftCardOrder": ["header", "guidance", "setup", ...],
  "rightCardOrder": ["drafting", "summary", "diagnostics"],
  "cardPositions": {
    "header": { "x": 10, "y": 10 },
    "guidance": { "x": 10, "y": 200 },
    "drafting": { "x": 500, "y": 10 }
  }
}
```

### 3. Add Mode Toggle
Add UI control to switch between lane mode and free positioning mode:
- Button in card layout panel
- Persists mode preference
- Gracefully converts between modes

### 4. Migration Logic
```typescript
function migrateLayout() {
  const v3 = getStoredLayout('scd.bushing.layout.v3');
  if (!v3) return;
  
  const v4 = {
    version: 4,
    mode: 'lanes',
    leftCardOrder: v3.leftCardOrder,
    rightCardOrder: v3.rightCardOrder,
    cardPositions: generateDefaultPositions(v3)
  };
  
  saveLayout('scd.bushing.layout.v4', v4);
}
```

## Acceptance Criteria
- [ ] Can toggle between lane mode and free positioning mode
- [ ] Cards can be dragged to any screen position in free mode
- [ ] Positions persist after page reload
- [ ] Migration from v3 to v4 works correctly
- [ ] Lane mode still works as before
- [ ] No file size policy violations

## Files to Create
- `src/lib/components/bushing/BushingCardContainer.svelte`

## Files to Modify
- `src/lib/components/bushing/BushingOrchestrator.svelte`
- `src/lib/components/bushing/BushingLayoutPersistence.ts`
- `src/lib/components/bushing/BushingCardLayoutPanel.svelte`

## Testing
- Toggle between modes
- Drag cards in free mode
- Reload page and verify positions
- Test migration from v3 to v4
- Verify lane mode still works

## Estimated Time
4-6 hours

## Dependencies
- BCC-001 must be completed first
