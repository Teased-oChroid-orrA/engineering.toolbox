# BCC-001: Fix Card Disappearing During Drag Operations

## Priority
**CRITICAL** - Blocks core functionality

## Description
Fix the issue where bushing toolbox cards disappear when they are dragged and released. This is the primary bug that needs to be addressed.

## Root Cause
1. Reactive statements in `BushingOrchestrator.svelte` recreate item arrays on every state change
2. When finalize event fires, the parent component immediately updates `leftCardOrder` or `rightCardOrder`
3. This triggers reactive statement `$: leftLaneItems = leftCardOrder.map((id) => ({ id }))`
4. New items array reference is passed to `BushingSortableLane`
5. `BushingSortableLane` syncs `workingItems` via `$: workingItems = items` (line 39)
6. DOM re-renders interrupt the 200ms FLIP animation
7. Cards disappear or snap back

## Solution
Defer state updates until after FLIP animation completes.

## Implementation Steps
1. Add drag state tracking to `BushingSortableLane`:
   - Add `isDragging` state variable
   - Set to `true` on consider event
   - Set to `false` on finalize event
   
2. Defer finalize event propagation in `BushingSortableLane`:
   ```typescript
   function handleFinalize(ev: CustomEvent<DndEvent<{ id: string }>>) {
     workingItems = ev.detail.items;
     // Defer dispatch to allow FLIP animation to complete
     setTimeout(() => {
       dispatch('finalize', { items: ev.detail.items });
     }, flipDurationMs + 50); // Add buffer
   }
   ```

3. Update `BushingOrchestrator.svelte` to use stable references:
   - Store items in component state instead of deriving from order
   - Only update when finalize events fire, not reactively

4. Test drag operations:
   - Drag first card to last position
   - Drag last card to first position
   - Verify cards remain visible

## Acceptance Criteria
- [ ] Cards do not disappear after drag-and-drop
- [ ] Card reordering works correctly
- [ ] Position persists after reload
- [ ] No animation glitches or flickers
- [ ] Existing tests pass

## Files to Modify
- `src/lib/components/bushing/BushingSortableLane.svelte`
- `src/lib/components/bushing/BushingOrchestrator.svelte`
- `src/lib/components/bushing/BushingRightLaneCards.svelte`

## Testing
- Manual testing with dev server
- Playwright test for drag operations
- Verify persistence after page reload

## Estimated Time
2-3 hours
